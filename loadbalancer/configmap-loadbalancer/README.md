# Configmap backend controller for Load balancer

The project implements a configmap controller that will provide access and load balancing to HTTP and TCP applications based on configmaps generated by the load balancer controller.
This controller works with the Load Balancer Controller to provide an end-to-end software load balancer solution.

This configmap backend controller is designed to easily integrate and create different load balancing backends. Our initial backend is nginx.  It also provides SSL support for http apps.

Although this project was primarely designed to work with the Load Balancer Controller, you can also use this controller as a stand alone to configure a backend for load balancing your apps.

## Examples

### HTTP Load Balancing:
1. Create coffee web app, which consists of a service and replication controller resource:

  ```
  $ kubectl create -f examples/coffee-app.yaml
  ```

1. Create controller Resource:
  ```
  $ kubectl create -f configmap-loadbalancer-rc.yaml
  ```

#### These steps are used when using this controller as standalone:

1. The Controller container exposes ports 80 and 3306 on the host it runs. 
Make sure to add a firewall to allow incoming traffic on this ports.

1. Create configmap for the coffee service. NOTE: This configmap resource will be generated by the load balancer controller but if you choose to run it as a
standalone, you can run it this way:
  ```
  $ kubectl create -f coffee-configmap.yaml
  ```

1. Find out the node/external IP address of the node of the controller:
  ```
  $ kubectl get pods -o wide
  NAME                          READY     STATUS    RESTARTS   AGE       NODE
  coffee-rc-mtjuw               1/1       Running   0          3m        172.17.4.202
  coffee-rc-mu9ns               1/1       Running   0          3m        172.17.4.202
  configmap-loadbalancer-rc-9p6 1/1       Running   0          1m        172.17.4.201
  mysql-pod                     1/1       Running   0          1h        172.17.4.202
  ```

  ```
  $ kubectl get node 172.17.4.201 -o json | grep -A 2 ExternalIP
      "type": "ExternalIP",
    "address": "XXX.YYY.ZZZ.III"
    }
  ```

1. We'll use ```curl```'s --resolve option to set the Host header of a request with ```foo.bar.com```.
   To get coffee:
  ```
  $ curl --resolve foo.bar.com:80:XXX.YYY.ZZZ.III http://foo.bar.com/coffee
  <!DOCTYPE html>
  <html>
  <head>
  <title>Hello from NGINX!</title>
  <style>
      body {
          width: 35em;
          margin: 0 auto;
          font-family: Tahoma, Verdana, Arial, sans-serif;
      }
  </style>
  </head>
  <body>
  <h1>Hello!</h1>
  <h2>URI = /coffee</h2>
  <h2>My hostname is coffee-rc-mu9ns</h2>
  <h2>My address is 10.244.0.3:80</h2>
  </body>
  </html>
  ```

**Note**: Implementations are experimental and not suitable for using in production. This project is still in its early stage and many things are still in work in progress.
